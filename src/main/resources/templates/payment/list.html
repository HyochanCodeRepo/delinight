<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>정산 내역 조회</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

<form id="paymentForm">
    <h1>정산 내역 조회</h1>

    <div class="row">
        <!-- 날짜 필터 -->
        <div class="col-6">
            <label for="startDate">시작 날짜:</label>
            <input type="date" id="startDate" name="startDate">
        </div>
        <div class="col-6">
            <label for="endDate">종료 날짜:</label>
            <input type="date" id="endDate" name="endDate">
        </div>
    </div>

    <div class="row">
        <!-- 결제 방식 필터 -->
        <div class="col-6">
            <label for="orderType">결제 방식:</label>
            <select id="orderType" name="orderType">
                <option value="선결제">선결제</option>
                <option value="후결제">후결제</option>
            </select>
        </div>

        <!-- 정산 여부 필터 -->
        <div class="col-6">
            <label for="paidCheck">정산 여부:</label>
            <select id="paidCheck" name="paidCheck">
                <option value="Y">정산 완료</option>
                <option value="N">미정산</option>
            </select>
        </div>
    </div>

    <!-- 정산 타입 선택 (center, branch, hotel, store) -->
    <div class="row">
        <div class="col-6">
            <label for="type">정산 타입:</label>
            <select id="type" name="type">
                <option value="CENTER">본사</option>
                <option value="BRANCH">지점</option>
                <option value="HOTEL">호텔</option>
                <option value="STORE">가맹점</option>
            </select>
        </div>
    </div>

    <!-- 조회 버튼 -->
    <button type="submit">조회</button>
</form>

<hr>

<!-- 결제 내역 테이블 -->
<table id="paymentResults">
    <thead>
    <tr>
        <th>결제 ID</th>
        <th>결제 금액</th>
        <th>결제 일시</th>
        <th>결제 방식</th>
        <th>매장명</th>
        <th>호텔명</th>
        <th>지점명</th>
        <th>센터명</th>
        <th>객실 번호</th>
        <th>정산 여부</th>
    </tr>
    </thead>
    <tbody>
    <!-- AJAX로 받아온 데이터가 여기에 채워짐 -->
    </tbody>
</table>

<script>
    // 폼 제출 시 이벤트 처리
    $("#paymentForm").submit(function (event) {
        event.preventDefault();  // 폼이 실제로 제출되지 않도록 방지

        // 필터 값 가져오기
        let startDate = $("#startDate").val();
        let endDate = $("#endDate").val();
        let orderType = $("#orderType").val();
        let paidCheck = $("#paidCheck").val();
        let type = $("#type").val();  // 정산 타입 가져오기

        // 필터값을 데이터로 준비하여 AJAX 요청 보내기
        $.ajax({
            url: '/api/payment/allDate',
            type: 'GET',
            data: {
                totalId: 1,  // 예시로 totalId를 고정값으로 사용
                type: type,   // 사용자가 선택한 정산 타입
                startDate: startDate,
                endDate: endDate,
                orderType: orderType,
                paidCheck: paidCheck
            },
            success: function(response) {
                console.log(response); // 서버에서 반환된 데이터 전체를 콘솔에 출력

                const tableBody = $('#paymentResults tbody');
                tableBody.empty();  // 기존 테이블 내용 비우기

                // 서버에서 받은 데이터를 테이블에 채우기
                response.forEach(function(payment) {
                    const row = `
                            <tr>
                                <td>${payment.id}</td>
                                <td>${payment.amount}</td>
                                <td>${payment.payDateTime}</td>
                                <td>${payment.orderType}</td>
                                <td>${payment.storeName}</td>
                                <td>${payment.hotelName}</td>
                                <td>${payment.branchName}</td>
                                <td>${payment.centerName}</td>
                                <td>${payment.checkInRoomNumber ?? '-'}</td>
                                <td>${payment.paidCheckType}</td>
                            </tr>
                        `;
                    tableBody.append(row);
                });
            },
            error: function(xhr, status, error) {
                console.log("정산 조회 실패:", error);
            }
        });
    });
</script>

</body>
</html>
